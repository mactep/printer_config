[gcode_macro CENTER_NOZZLE]
gcode:
    # Get the bed dimensions from the toolhead
    {% set bed_x_max = printer.toolhead.axis_maximum.x %}
    {% set bed_y_max = printer.toolhead.axis_maximum.y %}
    
    # Get the minimum bed position (accounts for negative position_min)
    {% set bed_x_min = printer.toolhead.axis_minimum.x %}
    {% set bed_y_min = printer.toolhead.axis_minimum.y %}

    # Get the homing speed from the stepper_x section of the config
    # Use a safe default if homing_speed isn't available or use a standard travel speed
    {% set travel_speed = printer.configfile.settings.stepper_x.homing_speed|default(50) %}
    
    # Calculate the center coordinates by averaging the min and max
    # This correctly centers the position even if bed_x_min or bed_y_min are negative
    {% set center_x = (bed_x_max + bed_x_min) / 2 %}
    {% set center_y = (bed_y_max + bed_y_min) / 2 %}

    # Move to the center of the bed using the travel speed
    # Convert mm/s (homing_speed) to mm/min for G0/G1 feedrate
    G0 X{center_x} Y{center_y} F{travel_speed * 60}

[gcode_macro CENTER_PROBE]
gcode:
    # Get the bed dimensions from the toolhead
    {% set bed_x_max = printer.toolhead.axis_maximum.x %}
    {% set bed_y_max = printer.toolhead.axis_maximum.y %}
    
    # Get the minimum bed position (accounts for negative position_min)
    {% set bed_x_min = printer.toolhead.axis_minimum.x %}
    {% set bed_y_min = printer.toolhead.axis_minimum.y %}

    # Get the probe offsets from the probe section
    # Use 0 as a default if the offset is not configured
    {% set probe_x_offset = printer.configfile.settings.probe.x_offset|default(0) %}
    {% set probe_y_offset = printer.configfile.settings.probe.y_offset|default(0) %}

    # Get the homing speed from the stepper_x section of the config
    # Use 50 mm/s as a safe default for travel speed
    {% set travel_speed = printer.configfile.settings.stepper_x.homing_speed|default(50) %}

    # Calculate the center coordinates for the NOZZLE
    # This correctly calculates the midpoint of the bed, even with negative min positions
    {% set center_x = (bed_x_max + bed_x_min) / 2 %}
    {% set center_y = (bed_y_max + bed_y_min) / 2 %}

    # Calculate the NOZZLE position needed to place the PROBE at the bed center
    {% set probe_center_x = center_x - probe_x_offset %}
    {% set probe_center_y = center_y - probe_y_offset %}

    # Move the toolhead to position the PROBE at the bed center
    # Convert mm/s (travel_speed) to mm/min for G0/G1 feedrate
    G0 X{probe_center_x} Y{probe_center_y} F{travel_speed * 60}
