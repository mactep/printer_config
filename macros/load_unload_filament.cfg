[extruder]
max_extrude_only_distance: 400

[gcode_macro _FILAMENT_VARS]
variable_filament_distance:   400  # Common distance for both loading and unloading filament
variable_purge_distance:      50   # Distance to purge filament after loading
variable_nozzle_preheat_temp: 200  # Default preheat temperature for the nozzle
variable_min_temp:            200  # Safe minimum temperature for extrusion
variable_turn_off_extruder:   True # Option to turn off the extruder after action (True/False)
gcode:
    M118 Do not call _FILAMENT_VARS directly

[gcode_macro LOAD_FILAMENT]
variable_load_distance:  350
variable_purge_distance:  50
gcode:
    {% set speed = (params.SPEED * 60)|default(180) %}
    {% set max_velocity = 600 %}
    SAVE_GCODE_STATE NAME=load_state
    G91
    G92 E0
    G1 E{load_distance} F{max_velocity} # fast-load
    G1 E{purge_distance} F{speed} # purge
    RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
variable_unload_distance:  350
variable_purge_distance:  50
gcode:
    {% set speed = (params.SPEED * 60)|default(180) %}
    {% set max_velocity = 600 %}
    SAVE_GCODE_STATE NAME=unload_state
    G91
    G92 E0
    G1 E{purge_distance} F{speed} # purge
    G1 E-{unload_distance} F{max_velocity} # fast-unload
    RESTORE_GCODE_STATE NAME=unload_state
